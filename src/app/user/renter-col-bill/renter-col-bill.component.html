
<body class="grey lighten-3 min-vh-100 wow fadeIn">
    <div class="container ">
      <div class="row py-5">
  
        <div class="col-md-3 ">
          <app-renter-menu></app-renter-menu>
        </div>
  
        <div class="col-md-9 ">
            <div class="text-center mb-3 ">
                <div class="h3 text-center">DANH SÁCH HÓA ĐƠN DỊCH VỤ</div>
                <p>(Quý vị có thể quản lý, tìm kiếm ở đây)</p>
              </div>
              <div class="card mb-5 wow fadeIn">
                <div class="card-header text-center  h5"><strong>Quản lý(xuất,nhập) hóa đơn hằng tháng</strong></div>
                <div class="card-body">
                  <div class="md-form">
                    <input matInput mdbInput type="text" id="form1" class="form-control" (keyup)="applyFilter($event)">
                    <label for="form1">Lọc</label>
                  </div>
                  <div mdbTable bordered="true" hover="true" >
                    <table mat-table matSort [dataSource]="dataSource" class="w-100">
            
                      <ng-container matColumnDef="colId">
                        <th *matHeaderCellDef mat-sort-header>Mã hóa đơn</th>
                        <td *matCellDef="let element">{{element.colId}}
                        </td>
                      </ng-container>
                      <ng-container matColumnDef="placeId">
                        <th *matHeaderCellDef mat-sort-header>Thông tin nhà</th>
                        <td *matCellDef="let element">
                          <a type="button" mdbBtn color="info" size='sm' (click)="sharedService.placeDetail(element.placeId)" mdbWavesEffect><i class="fas fa-info"></i></a>
                        </td>
                      </ng-container>
                      <ng-container matColumnDef="dateCollect">
                        <th *matHeaderCellDef mat-sort-header>Ngày thu tiền</th>
                        <td *matCellDef="let element"> {{element.dateCollect | date:'shortDate'}} </td>
                      </ng-container>
            
                      <ng-container matColumnDef="deadLineStatus">
                        <th *matHeaderCellDef mat-sort-header>Hạn thu tiền</th>
                        <td *matCellDef="let element" class="red-text"> {{element.dateCollect | deadlineBill:element.paymentStatusId }} </td>
                      </ng-container>
            
                      <ng-container matColumnDef="totalExpense">
                        <th *matHeaderCellDef mat-sort-header>Tổng thu(vnđ)</th>
                        <td *matCellDef="let element"> 
                          {{element.totalExpense | number}}<small>vnd</small> /{{vndToUsd(element.totalExpense)}}<small>usd</small>
                        </td>
                      </ng-container>
            
                      <ng-container matColumnDef="paymentStatusName">
                        <th *matHeaderCellDef mat-sort-header>Trạng thái hóa đơn</th>
                        <td *matCellDef="let element" class="font-weight-bold" > {{element.paymentStatusId | billStatusName}} </td>
                      </ng-container>
            
                      <ng-container matColumnDef="button">
                        <th *matHeaderCellDef>Chi tiết các khoản phí</th>
                        <td *matCellDef="let element">
                          <a type="button" mdbBtn color="warning" size='sm' (click)="onBillDetail(element)" mdbWavesEffect><i class="fas fa-info"></i></a>
                        </td>
                      </ng-container>
                      <ng-container matColumnDef="paypal">
                        <th *matHeaderCellDef>Thanh toán
                        </th>
                        <td *matCellDef="let element">
                          <app-paypal-button *ngIf="!isBillPending(element.paymentStatusId)" [pay]='getPay(element)'
                          (payResult)='getPayResult($event)'></app-paypal-button>
                          <a type="button" *ngIf='element.cashPaidLink' [href]="element.cashPaidLink" mdbBtn color="success"
                          size="sm" mdbWavesEffect>Xem hóa đơn tiền mặt</a>
                        </td>
                      </ng-container>
            
                      <tr mdbTableCol mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                      <tr mdbTableCol mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                    </table>
                    <mat-paginator [pageSizeOptions]="[10]" showFirstLastButtons></mat-paginator>
                  </div>
                </div>
            
              </div> 
          </div>
      </div>
    </div>

    
    <div mdbModal #billDetailModal="mdbModal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true"
    [config]="{backdrop: false, ignoreBackdropClick: false}">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content p-5">
          <table class="table table-bordered">
            <thead class="thead-light">
              <tr>
                <th scope="col">#</th>
                <th scope="col">Tên dịch vụ</th>
                <th scope="col">Đơn giá(vnđ)</th>
                <th scope="col">Số lượng </th>
                <th scope="col">Đơn vị </th>
                <th scope="col">Thành tiền(vnđ) </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of bill?.colBillDetails; let i = index">
                <th scope="row">{{i}}</th>
                <td>{{item.costName}}</td>
                <td>{{item.costPrice | number}}</td>
                <td>
                  {{item.amount | number}}
                </td>
                <td>{{item.unitName}}</td>
                <td>{{item.amount*item.costPrice | number}}</td>
              </tr>
              <tr>
                <th scope="row">{{bill?.colBillDetails.length}}</th>
                <td> Phí thuê nhà</td>
                <td>{{bill?.placePrice | number}}</td>
                <td>1 </td>
                <td>1 tháng</td>
                <td>{{bill?.placePrice | number}}</td>
              </tr>
              <tr>
                <th></th>
                <th colspan="4">Tổng thu(vnđ)</th>
                <th>
                  {{bill?.totalExpense | number}}
                </th>
              </tr>
            </tbody>
          </table>
        </div>
    </div>
  </div>
  </body>